{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shivansh%20Rana/Desktop/DTU%20Academic/Codes/WEBD/SIH25008/frontend/src/app/auth/success/page.js"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useRef } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { useToast } from '@/app/context/ToastContext';\nimport { useAuth } from '@/app/context/AuthContext';\n\nexport default function AuthSuccess() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const toast = useToast();\n  const { setUser } = useAuth();\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [isClient, setIsClient] = useState(false);\n  \n  // Refs to track state and prevent duplicate operations\n  const hasShownToast = useRef(false);\n  const hasProcessedAuth = useRef(false);\n  const redirectTimer = useRef(null);\n  const errorRedirectTimer = useRef(null);\n  \n  // Set isClient to true once component mounts (client-side only)\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n  \n  // Display initial success message only once\n  useEffect(() => {\n    if (isClient && !hasShownToast.current) {\n      toast.showSuccessToast('Login successful! Redirecting to dashboard...');\n      hasShownToast.current = true;\n    }\n  }, [isClient, toast]);\n\n  // Main authentication logic\n  useEffect(() => {\n    // Only run on client-side\n    if (!isClient) return;\n    \n    // Get token and userId from URL params\n    const token = searchParams.get('token');\n    const userId = searchParams.get('userId');\n\n    console.log('Auth Success Page - Token:', token ? 'Present' : 'Missing');\n    console.log('Auth Success Page - UserId:', userId ? 'Present' : 'Missing');\n\n    // Prevent processing more than once\n    if (hasProcessedAuth.current) return;\n    \n    // Check if we've already processed this login in a previous session\n    const hasProcessed = sessionStorage.getItem('auth_processed');\n    \n    if (hasProcessed) {\n      console.log('Auth already processed, redirecting to dashboard');\n      const storedUser = localStorage.getItem('user');\n      if (storedUser) {\n        try {\n          const user = JSON.parse(storedUser);\n          // Update the AuthContext state with the stored user\n          setUser(user);\n          const redirectPath = user.role === 'teacher' ? '/dashboard/teacher' : '/dashboard/student';\n          router.push(redirectPath);\n        } catch (e) {\n          console.error('Error parsing stored user:', e);\n          router.push('/login');\n        }\n      } else {\n        // If no user in localStorage but we have token/userId in URL, process the auth again\n        if (token && userId) {\n          console.log('No stored user but have token/userId, processing auth again');\n          sessionStorage.removeItem('auth_processed');\n        } else {\n          router.push('/login');\n          return;\n        }\n      }\n      return;\n    }\n    \n    // Mark that we've started processing this authentication\n    hasProcessedAuth.current = true;\n    \n    const processAuthentication = async () => {\n      if (!token || !userId) {\n        handleAuthError('Missing token or user ID');\n        return;\n      }\n      \n      try {\n        // Fetch user data to get role and other information\n        const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5000';\n        const profileUrl = `${apiUrl}/api/users/profile`;\n        console.log('Fetching user profile from:', profileUrl);\n        \n        const response = await fetch(profileUrl, {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'application/json'\n          },\n          cache: 'no-store' // Prevent caching issues\n        });\n        \n        console.log('Profile API Response Status:', response.status);\n        if (!response.ok) {\n          throw new Error(`Failed to fetch user profile: ${response.status}`);\n        }\n        \n        const userData = await response.json();\n        console.log('User data received:', userData);\n        \n        // Create user object with token and user data\n        const user = {\n          _id: userId,\n          name: userData.name,\n          email: userData.email,\n          username: userData.username,\n          role: userData.role || 'student', // Default to student if role is missing\n          token: token\n        };\n\n        console.log('Saving user to localStorage and AuthContext:', user);\n        // Save user to localStorage\n        localStorage.setItem('user', JSON.stringify(user));\n        \n        // Update the AuthContext state with the user\n        setUser(user);\n        \n        // Mark this authentication as processed in session storage AFTER successful profile fetch\n        sessionStorage.setItem('auth_processed', 'true');\n        \n        // Show success message (only if we haven't already)\n        if (!hasShownToast.current) {\n          toast.showSuccessToast('Successfully logged in with Google!');\n          hasShownToast.current = true;\n        }\n        \n        setLoading(false);\n        \n        // Redirect based on user role\n        const redirectPath = userData.role === 'teacher' ? '/dashboard/teacher' : '/dashboard/student';\n        console.log('Redirecting to:', redirectPath);\n        \n        // Add a small delay before redirecting to ensure localStorage is updated\n        redirectTimer.current = setTimeout(() => {\n          router.push(redirectPath);\n        }, 2000);\n      } catch (error) {\n        console.error('Error during Google auth success:', error);\n        handleAuthError(error.message);\n      }\n    };\n    \n    const handleAuthError = (errorMessage) => {\n      setError(errorMessage);\n      setLoading(false);\n      toast.showErrorToast(`Authentication error: ${errorMessage}`);\n      // Clear the auth processed flag on error\n      sessionStorage.removeItem('auth_processed');\n      // Clear any existing user data to prevent login loops\n      localStorage.removeItem('user');\n      // Clear the AuthContext state\n      setUser(null);\n      errorRedirectTimer.current = setTimeout(() => {\n        router.push('/login');\n      }, 3000);\n    };\n    \n    processAuthentication();\n    \n    // Return cleanup function to clear timers and session storage if component unmounts\n    return () => {\n      if (redirectTimer.current) clearTimeout(redirectTimer.current);\n      if (errorRedirectTimer.current) clearTimeout(errorRedirectTimer.current);\n    };\n  }, [isClient, searchParams, router, toast]); // Add isClient as dependency\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen bg-gray-100\">\n      <div className=\"w-full max-w-md p-8 space-y-8 bg-white rounded-lg shadow-md\">\n        <div className=\"text-center\">\n          <h2 className=\"mt-6 text-3xl font-extrabold text-gray-900\">\n            {error ? 'Authentication Error' : 'Completing login...'}\n          </h2>\n          <p className=\"mt-2 text-sm text-gray-600\">\n            {error \n              ? `Error: ${error}. Redirecting to login page...` \n              : 'Please wait while we redirect you to your dashboard.'}\n          </p>\n          {/* Debug info - only visible during development and only on client-side */}\n          {isClient && (\n            <div className=\"mt-4 p-4 bg-gray-100 rounded text-left text-xs\">\n              <p>Debug Info:</p>\n              <p>Token: {searchParams.get('token') ? 'Present' : 'Missing'}</p>\n              <p>User ID: {searchParams.get('userId') ? 'Present' : 'Missing'}</p>\n            </div>\n          )}\n        </div>\n        <div className=\"flex justify-center\">\n          {loading ? (\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n          ) : error ? (\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-12 w-12 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          ) : (\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-12 w-12 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n            </svg>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 338, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Shivansh%20Rana/Desktop/DTU%20Academic/Codes/WEBD/SIH25008/frontend/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}